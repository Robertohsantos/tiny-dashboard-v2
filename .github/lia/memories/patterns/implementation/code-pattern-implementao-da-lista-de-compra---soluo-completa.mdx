---
id: code-pattern-implementao-da-lista-de-compra---soluo-completa
type: code_pattern
category: implementation
confidence: 0.95
created_at: '2025-09-25T03:33:19.118Z'
updated_at: '2025-09-25T03:33:19.118Z'
tags:
  - purchase-list
  - adapter-pattern
  - mock-data
  - produtos
  - api
source: user_input
project_root: /home/roberto/tiny-dashboard
relationships: []
---

# Implementação da Lista de Compra - Solução Completa

## Contexto

Foi implementada a funcionalidade completa de lista de compra gerada a partir do modal de necessidade de compra na página de produtos.

## Problema Principal Resolvido

O cálculo de necessidade de compra não funcionava porque havia incompatibilidade entre as fontes de dados:

- ProdutosService usava dados mockados
- PurchaseRequirementService tentava acessar o banco Prisma (vazio em desenvolvimento)

## Solução Implementada

### 1. Adapter Pattern para Unificar Fontes de Dados

Criado `ProdutosDataAdapter` que:

- Em desenvolvimento: usa dados mockados do ProdutosService
- Em produção: usa banco Prisma
- Mapeia entre interfaces Produto (UI) e Product (Prisma)

### 2. Mock para StockCoverageService

Adicionado método `getMockCoverage()` que retorna dados simulados em desenvolvimento, evitando erros de conexão com banco.

### 3. Correções na API

- Removida validação UUID para aceitar "mock-org-123" em desenvolvimento
- Corrigido uso de `batchProcess` com assinatura correta
- Ajustado nome do método de `getProducts` para `getProdutos`

### 4. Modal de Lista de Compra

Implementado com 3 abas:

- Visão Geral: distribuição de riscos
- Por Fornecedor: agrupamento por fornecedor
- Detalhes: tabela completa com busca e filtros

## Arquivos Principais

- `/src/modules/produtos/services/produtos-data-adapter.ts` - Adapter para dados
- `/src/modules/produtos/components/shared/modals/purchase-list-modal.tsx` - Modal de lista
- `/src/modules/stock-coverage/services/stock-coverage.service.ts` - Mock de cobertura
- `/src/app/api/products/purchase-requirement/route.ts` - Endpoint API

## Resultados

- API funcionando corretamente
- Retornando 150 produtos mockados
- Sem erros de banco de dados
- Arquitetura limpa e profissional sem "gambiarras"
